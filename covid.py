import discord
from bs4 import BeautifulSoup
import requests
import urllib

client = discord.Client()


@client.event
async def on_ready():
    print("ë´‡ì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.")
    game = discord.Game('ì½”ë¡œë‚˜ í˜„í™©')
    await client.change_presence(status=discord.Status.online, activity=game)


@client.event
async def on_message(message):
    if message.content.startswith('!ì½”ë¡œë‚˜'):
        url = 'http://ncov.mohw.go.kr/bdBoardList_Real.do?brdId=1&brdGubun=11&ncvContSeq=&contSeq=&board_id=&gubun='
        html = urllib.request.urlopen(url)
        soup = BeautifulSoup(html, "html.parser")

        datecr = soup.find('span', {'class': 't_date'}) #ê¸°ì¤€ë‚ ì§œ
        #print(f'ê¸°ì¤€ì¼: {datecr.string}')

        totalcovid = soup.select('dd.ca_value')[0].text #ëˆ„ì  í™•ì§„ììˆ˜
        #print(f'ëˆ„ì  í™•ì§„ì: {totalcovid} ëª…')

        todaytotalcovid = soup.select('p.inner_value')[0].text #ë‹¹ì¼ í™•ì§„ììˆ˜ ì†Œê³„
        #print(f'í™•ì§„ì ì†Œê³„: {todaytotalcovid} ëª…')

        todaydomecovid = soup.select('p.inner_value')[1].text #ë‹¹ì¼ êµ­ë‚´ë°œìƒ í™•ì§„ììˆ˜
        #print(f'êµ­ë‚´ë°œìƒ: {todaydomecovid} ëª…')

        todayforecovid = soup.select('p.inner_value')[2].text #ë‹¹ì¼ í•´ì™¸ìœ ì… í™•ì§„ììˆ˜
        #print(f'í•´ì™¸ìœ ì…: {todayforecovid} ëª…')

        totalca = soup.select('dd.ca_value')[2].text #ëˆ„ì  ê²©ë¦¬í•´ì œ
        #print(f'ëˆ„ì  ê²©ë¦¬í•´ì œ: {totalca} ëª…')

        todayca = soup.select('span.txt_ntc')[0].text #ë‹¹ì¼ ê²©ë¦¬í•´ì œ
        #print(f'ê²©ë¦¬í•´ì œ: {todayca} ëª…')

        totalcaing = soup.select('dd.ca_value')[4].text #ëˆ„ì  ê²©ë¦¬ì¤‘
        #print(f'ëˆ„ì  ê²©ë¦¬ì¤‘: {totalcaing}')

        todaycaing = soup.select('span.txt_ntc')[1].text #ë‹¹ì¼ ê²©ë¦¬ì¤‘
        #print(f'ê²©ë¦¬ì¤‘: {todaycaing} ëª…')

        totaldead = soup.select('dd.ca_value')[6].text #ëˆ„ì  ì‚¬ë§ì
        #print(f'ëˆ„ì  ì‚¬ë§ì: {totaldead} ëª…')

        todaydead = soup.select('span.txt_ntc')[2].text #ë‹¹ì¼ ì‚¬ë§ì
        #print(f'ì‚¬ë§ì: {todaydead} ëª…')

        covidembed = discord.Embed(title='ì½”ë¡œë‚˜19 êµ­ë‚´ ë°œìƒí˜„í™©', description="", color=0xFF0F13, url='http://ncov.mohw.go.kr/')
        covidembed.add_field(name='ğŸ¦  í™•ì§„í™˜ì', value=f'{totalcovid}({todaytotalcovid}) ëª…'
                                                f'\n\nêµ­ë‚´ë°œìƒ: {todaydomecovid} ëª…\ní•´ì™¸ìœ ì…: {todayforecovid} ëª…', inline=False)
        covidembed.add_field(name='ğŸ˜· ê²©ë¦¬ì¤‘', value=f'{totalcaing}({todaycaing}) ëª…', inline=False)
        covidembed.add_field(name='ğŸ†“ ê²©ë¦¬í•´ì œ', value=f'{totalca}({todayca}) ëª…', inline=False)
        covidembed.add_field(name='ğŸ’€ ì‚¬ë§ì', value=f'{totaldead}({todaydead}) ëª…', inline=False)
        covidembed.set_footer(text=datecr.string)
        await message.channel.send(embed=covidembed)
        
client.run('ODEwMDc3MzMwNTYzMjY4NjY4.YCeZTg.Tx1uqPiJMOG9KHIHjOrTEAmLJig')
